# -*- coding: utf-8 -*-
# @File  : renamefile.py
# @Author: Frank
# @Date  : 2018-09-22

'''rename the file with it's MD5 value to remove duplicate ones'''

import hashlib
import os
import time

# 1.获取文件MD5值
def get_md5(file_name,path):
    with open(os.path.join(path,file_name),'rb') as f:
        md5obj = hashlib.md5()
        md5obj.update(f.read())
        hash = md5obj.hexdigest()
    #print(hash,type(hash))
    return hash

#2.找出当前的文件的后缀名
def file_type(file):
    filename = file.split('.')[0]
    filetype = file.split('.')[-1]
    #print(filename,filetype)
    return filetype

#3.主函数:查找目标目录下的所有文件,并使用MD5值及后缀名重命名当前文件
#如遇到重复文件,使用数字重命名
def main(path):
    winerror = []
    for root,dirlist,filelist in os.walk(path):
        for file in filelist:
            newname =  '{0}.{1}'.format(get_md5(file,path), file_type(file))
            print(newname)
            try:
                if os.path.join(path,newname) == os.path.join(path,file):
                    pass
                else:
                    print('Now Renaming:', file, 'To', newname)
                    os.rename(os.path.join(path,file),os.path.join(path,newname))
            except WindowsError:
                nickname = 'A{0}.{1}'.format(str(len(winerror)),file_type(file))
                print('WindowsError for:',file, 'Renaming to:', nickname)
                winerror.append(file)
                os.rename(os.path.join(path,file),os.path.join(path,nickname))
    print(winerror)
    print(len(winerror))

#4.执行
path = r'D:\iPhoneshowdup\nameduplicate'
if __name__ == '__main__':
    starttime = time.time()
    main(path)
    endtime = time.time()
    usetime = endtime - starttime
    print('总计用时:', usetime, 's')
